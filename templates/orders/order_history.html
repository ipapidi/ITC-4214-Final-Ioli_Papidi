{% extends 'base/base.html' %}
{% load static %}

{% block title %}My Orders - RevForge{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/orders.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="text-light mb-2">
                        <i class="fas fa-shopping-bag me-3 text-danger"></i>
                        My Orders
                    </h1>
                    <p class="text-light">Track your order history and delivery status</p>
                </div>
                <div>
                    <a href="{% url 'products:product_list' %}" class="btn btn-outline-danger">
                        <i class="fas fa-plus me-2"></i>Shop More
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% if orders %}
        <!-- Orders List -->
        <div class="row">
            <div class="col-12">
                {% for order in orders %}
                <div class="order-card">
                    <!-- Order Header -->
                    <div class="order-header">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fas fa-receipt fa-2x"></i>
                            </div>
                            <div>
                                <h5 class="mb-0">Order #{{ order.order_number }}</h5>
                                <small class="text-light">
                                    <i class="fas fa-calendar me-1"></i>
                                    {{ order.created_at|date:"M d, Y" }} at {{ order.created_at|time:"g:i A" }}
                                </small>
                            </div>
                        </div>
                        <div class="text-end">
                            <div class="mb-1">
                                <span class="text-light fw-bold me-2">Order Status:</span>
                                <span class="status-badge status-{{ order.order_status }}">
                                    {{ order.get_order_status_display }}
                                </span>
                            </div>
                            <div>
                                <span class="text-light fw-bold me-2">Payment Status:</span>
                                <span class="payment-badge payment-{{ order.payment_status }}">
                                    {{ order.get_payment_status_display }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Order Body -->
                    <div class="order-body">
                        <!-- Order Items -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <h6 class="text-light mb-3">
                                    <i class="fas fa-boxes me-2 text-danger"></i>
                                    Order Items ({{ order.items.count }})
                                </h6>
                                {% for item in order.items.all %}
                                <div class="order-item">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <h6 class="text-light mb-1">{{ item.product_name }}</h6>
                                            <small class="text-light">SKU: {{ item.product_sku }}</small>
                                        </div>
                                        <div class="col-md-2 text-center">
                                            <span class="text-light">Qty: {{ item.quantity }}</span>
                                        </div>
                                        <div class="col-md-2 text-end">
                                            <span class="text-danger fw-bold">${{ item.total_price }}</span>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="card bg-dark border-danger">
                                    <div class="card-body">
                                        <h6 class="text-light mb-3">
                                            <i class="fas fa-map-marker-alt me-2 text-danger"></i>
                                            Shipping Address
                                        </h6>
                                        <p class="text-light mb-1">{{ order.shipping_address }}</p>
                                        <p class="text-light mb-1">{{ order.shipping_city }}, {{ order.shipping_state }} {{ order.shipping_postal_code }}</p>
                                        <p class="text-light mb-0">{{ order.shipping_country }}</p>
                                        <p class="text-light mt-2">
                                            <i class="fas fa-phone me-1"></i>{{ order.shipping_phone }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-dark border-danger">
                                    <div class="card-body">
                                        <h6 class="text-light mb-3">
                                            <i class="fas fa-calculator me-2 text-danger"></i>
                                            Order Summary
                                        </h6>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span class="text-light">Subtotal:</span>
                                            <span class="text-light">${{ order.subtotal }}</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span class="text-light">Tax:</span>
                                            <span class="text-light">${{ order.tax_amount }}</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span class="text-light">Shipping:</span>
                                            <span class="text-light">${{ order.shipping_cost }}</span>
                                        </div>
                                        {% if order.discount_amount > 0 %}
                                        <div class="d-flex justify-content-between mb-2">
                                            <span class="text-light">Discount:</span>
                                            <span class="text-success">-${{ order.discount_amount }}</span>
                                        </div>
                                        {% endif %}
                                        <hr class="border-danger">
                                        <div class="d-flex justify-content-between">
                                            <span class="text-light fw-bold">Total:</span>
                                            <span class="text-danger fw-bold fs-5">${{ order.total_amount }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Order Progress Tracker -->
                        <div class="progress-tracker">
                            <h6 class="text-light mb-3">
                                <i class="fas fa-truck me-2 text-danger"></i>
                                Order Progress
                            </h6>
                            <div class="progress-step">
                                <div class="step-icon step-completed">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div>
                                    <div class="text-light fw-bold">Order Placed</div>
                                    <small class="text-light">{{ order.created_at|date:"M d, Y g:i A" }}</small>
                                </div>
                            </div>
                            
                            <div class="progress-step">
                                <div class="step-icon {% if order.order_status in 'confirmed,processing,shipped,delivered' %}step-completed{% elif order.order_status == 'pending' %}step-current{% else %}step-pending{% endif %}">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div>
                                    <div class="text-light fw-bold">Order Confirmed</div>
                                    <small class="text-light">
                                        {% if order.order_status in 'confirmed,processing,shipped,delivered' %}
                                            Confirmed
                                        {% elif order.order_status == 'pending' %}
                                            Processing...
                                        {% else %}
                                            Pending
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                            
                            <div class="progress-step">
                                <div class="step-icon {% if order.order_status in 'processing,shipped,delivered' %}step-completed{% elif order.order_status == 'confirmed' %}step-current{% else %}step-pending{% endif %}">
                                    <i class="fas fa-cog"></i>
                                </div>
                                <div>
                                    <div class="text-light fw-bold">Processing</div>
                                    <small class="text-light">
                                        {% if order.order_status in 'processing,shipped,delivered' %}
                                            Processed
                                        {% elif order.order_status == 'confirmed' %}
                                            Processing...
                                        {% else %}
                                            Pending
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                            
                            <div class="progress-step">
                                <div class="step-icon {% if order.order_status in 'shipped,delivered' %}step-completed{% elif order.order_status == 'processing' %}step-current{% else %}step-pending{% endif %}">
                                    <i class="fas fa-shipping-fast"></i>
                                </div>
                                <div>
                                    <div class="text-light fw-bold">Shipped</div>
                                    <small class="text-light">
                                        {% if order.order_status in 'shipped,delivered' %}
                                            {% if order.shipped_at %}
                                                {{ order.shipped_at|date:"M d, Y" }}
                                            {% else %}
                                                Shipped
                                            {% endif %}
                                        {% elif order.order_status == 'processing' %}
                                            Preparing for shipment...
                                        {% else %}
                                            Pending
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                            
                            <div class="progress-step">
                                <div class="step-icon {% if order.order_status == 'delivered' %}step-completed{% elif order.order_status == 'shipped' %}step-current{% else %}step-pending{% endif %}">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div>
                                    <div class="text-light fw-bold">Delivered</div>
                                    <small class="text-light">
                                        {% if order.order_status == 'delivered' %}
                                            {% if order.delivered_at %}
                                                {{ order.delivered_at|date:"M d, Y" }}
                                            {% else %}
                                                Delivered
                                            {% endif %}
                                        {% elif order.order_status == 'shipped' %}
                                            In transit...
                                        {% else %}
                                            Pending
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="row mt-4">
                            <div class="col-12 text-end">
                                <a href="{% url 'orders:order_detail' order_number=order.order_number %}" class="btn btn-outline-danger me-2">
                                    <i class="fas fa-eye me-1"></i>View Details
                                </a>
                                {% if order.can_cancel %}
                                <a href="{% url 'orders:cancel_order' order_number=order.order_number %}" class="btn btn-outline-warning">
                                    <i class="fas fa-times me-1"></i>Cancel Order
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <i class="fas fa-shopping-bag"></i>
            <h3 class="text-light mb-3">No Orders Yet</h3>
            <p class="text-light mb-4">You haven't placed any orders yet. Start shopping to see your order history here!</p>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% endblock %} 